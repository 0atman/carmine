<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.carmine.tundra documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Carmine 2.0.0-alpha1 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="taoensso.carmine.html"><span>taoensso.carmine</span></a></li><li><a href="taoensso.carmine.commands.html"><span>taoensso.carmine.commands</span></a></li><li><a href="taoensso.carmine.connections.html"><span>taoensso.carmine.connections</span></a></li><li><a href="taoensso.carmine.locks.html"><span>taoensso.carmine.locks</span></a></li><li><a href="taoensso.carmine.message-queue.html"><span>taoensso.carmine.message-queue</span></a></li><li><a href="taoensso.carmine.protocol.html"><span>taoensso.carmine.protocol</span></a></li><li><a href="taoensso.carmine.ring.html"><span>taoensso.carmine.ring</span></a></li><li class="current"><a href="taoensso.carmine.tundra.html"><span>taoensso.carmine.tundra</span></a></li><li><a href="taoensso.carmine.utils.html"><span>taoensso.carmine.utils</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="taoensso.carmine.tundra.html#var--%3EDiskDataStore"><span>-&gt;DiskDataStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3ENippyFreezer"><span>-&gt;NippyFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3ETundraStore"><span>-&gt;TundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3EWorker"><span>-&gt;Worker</span></a></li><li><a href="taoensso.carmine.tundra.html#var-dirty"><span>dirty</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ensure"><span>ensure</span></a></li><li><a href="taoensso.carmine.tundra.html#var-fetch-keys"><span>fetch-keys</span></a></li><li><a href="taoensso.carmine.tundra.html#var-freeze"><span>freeze</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3EDiskDataStore"><span>map-&gt;DiskDataStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3ENippyFreezer"><span>map-&gt;NippyFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3ETundraStore"><span>map-&gt;TundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3EWorker"><span>map-&gt;Worker</span></a></li><li><a href="taoensso.carmine.tundra.html#var-put-keys"><span>put-keys</span></a></li><li><a href="taoensso.carmine.tundra.html#var-start"><span>start</span></a></li><li><a href="taoensso.carmine.tundra.html#var-stop"><span>stop</span></a></li><li><a href="taoensso.carmine.tundra.html#var-thaw"><span>thaw</span></a></li><li><a href="taoensso.carmine.tundra.html#var-tundra-store"><span>tundra-store</span></a></li><li><a href="taoensso.carmine.tundra.html#var-worker"><span>worker</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>taoensso.carmine.tundra documentation</h2><pre class="doc">Alpha - subject to change (hide the kittens!).
Semi-automatic datastore layer for Carmine. It's like the magix. Redis 2.6+.

Redis keys:
  * carmine:tundra:&lt;worker&gt;:dirty -&gt; set, dirty Redis keys.</pre><div class="public" id="var--%3EDiskDataStore"><h3>-&gt;DiskDataStore</h3><div class="usage"><code>(-&gt;DiskDataStore path)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.DiskDataStore.
</pre></div><div class="public" id="var--%3ENippyFreezer"><h3>-&gt;NippyFreezer</h3><div class="usage"><code>(-&gt;NippyFreezer opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.NippyFreezer.
</pre></div><div class="public" id="var--%3ETundraStore"><h3>-&gt;TundraStore</h3><div class="usage"><code>(-&gt;TundraStore freezer datastore opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.TundraStore.
</pre></div><div class="public" id="var--%3EWorker"><h3>-&gt;Worker</h3><div class="usage"><code>(-&gt;Worker conn wname job-fn running? opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.Worker.
</pre></div><div class="public" id="var-dirty"><h3>dirty</h3><div class="usage"><code>(dirty store ks)</code><code>(dirty store worker ks)</code></div><pre class="doc">Alpha - subject to change.
**MARKS GIVEN KEYS FOR EXPIRY** and adds them to a named worker's dirty
set for freezing to datastore on worker's next scheduled freeze. Throws an
exception if any keys don't exist.

****************************************************************************
Named worker MUST be running AND FUNCTIONING CORRECTLY or DATA WILL BE LOST!
****************************************************************************

Acts as a Redis command: call within a `wcar` context.</pre></div><div class="public" id="var-ensure"><h3>ensure</h3><div class="usage"><code>(ensure store ks)</code></div><pre class="doc">Alpha - subject to change.
BLOCKS to ensure given keys are available in Redis, fetching them from
datastore as necessary. Throws an exception if any keys couldn't be made
available.

Acts as a Redis command: call within a `wcar` context.</pre></div><div class="public" id="var-fetch-keys"><h3>fetch-keys</h3><div class="usage"><code>(fetch-keys store ks)</code></div><pre class="doc">[&lt;k&gt; ...] -&gt; {&lt;k&gt; &lt;frozen-content&gt;}.
</pre></div><div class="public" id="var-freeze"><h3>freeze</h3><div class="usage"><code>(freeze freezer x)</code></div><pre class="doc">Returns datastore-ready key content.
</pre></div><div class="public" id="var-map-%3EDiskDataStore"><h3>map-&gt;DiskDataStore</h3><div class="usage"><code>(map-&gt;DiskDataStore m__5665__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.DiskDataStore, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3ENippyFreezer"><h3>map-&gt;NippyFreezer</h3><div class="usage"><code>(map-&gt;NippyFreezer m__5665__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.NippyFreezer, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3ETundraStore"><h3>map-&gt;TundraStore</h3><div class="usage"><code>(map-&gt;TundraStore m__5665__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.TundraStore, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3EWorker"><h3>map-&gt;Worker</h3><div class="usage"><code>(map-&gt;Worker m__5665__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.Worker, taking a map of keywords to field values.
</pre></div><div class="public" id="var-put-keys"><h3>put-keys</h3><div class="usage"><code>(put-keys store content)</code></div><pre class="doc">{&lt;k&gt; &lt;frozen-content&gt; ...} -&gt; {&lt;k&gt; &lt;success?&gt; ...}.
</pre></div><div class="public" id="var-start"><h3>start</h3><div class="usage"><code>(start this)</code></div><pre class="doc">Returns true iff worker successfully started.
</pre></div><div class="public" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop this)</code></div><pre class="doc">Returns true iff worker successfully stopped.
</pre></div><div class="public" id="var-thaw"><h3>thaw</h3><div class="usage"><code>(thaw freezer x)</code></div><pre class="doc">Returns Redis-ready key content.
</pre></div><div class="public" id="var-tundra-store"><h3>tundra-store</h3><div class="usage"><code>(tundra-store &amp; [{:keys [freezer datastore cache-ttl-ms], :or {cache-ttl-ms (* 1000 60 60 60)}}])</code></div><pre class="doc">Alpha - subject to change.
TODO</pre></div><div class="public" id="var-worker"><h3>worker</h3><div class="usage"><code>(worker store conn opts)</code></div><pre class="doc">Alpha - subject to change.
Returns a threaded worker to routinely freeze Redis keys marked as dirty
to datastore.

Because a key will be dirtied at _most_ once for any number of local edits
since last freezing, we get full local write performance along with a knob
that allows us to balance local/datastore consistency with any costs that
may be involved (e.g. performance or tangible data transfer costs).

Marks successfully frozen keys as clean. Logs any errors - THESE ARE
IMPORTANT: an email or other appropriate notification mechanism is HIGHLY
RECOMMENDED.

Options:
  :name         - Allows multiple workers &amp; dirty key sets.
  :frequency-ms - Interval between each freezing.</pre></div></div></body></html>