<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.carmine.tundra documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Carmine 2.4.0-beta2 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="taoensso.carmine.html"><span>taoensso.carmine</span></a></li><li><a href="taoensso.carmine.benchmarks.html"><span>taoensso.carmine.benchmarks</span></a></li><li><a href="taoensso.carmine.commands.html"><span>taoensso.carmine.commands</span></a></li><li><a href="taoensso.carmine.connections.html"><span>taoensso.carmine.connections</span></a></li><li><a href="taoensso.carmine.locks.html"><span>taoensso.carmine.locks</span></a></li><li><a href="taoensso.carmine.message-queue.html"><span>taoensso.carmine.message-queue</span></a></li><li><a href="taoensso.carmine.protocol.html"><span>taoensso.carmine.protocol</span></a></li><li><a href="taoensso.carmine.ring.html"><span>taoensso.carmine.ring</span></a></li><li class="current"><a href="taoensso.carmine.tundra.html"><span>taoensso.carmine.tundra</span></a></li><li><a href="taoensso.carmine.tundra.carmine.html"><span>taoensso.carmine.tundra.carmine</span></a></li><li><a href="taoensso.carmine.tundra.disk.html"><span>taoensso.carmine.tundra.disk</span></a></li><li><a href="taoensso.carmine.tundra.faraday.html"><span>taoensso.carmine.tundra.faraday</span></a></li><li><a href="taoensso.carmine.tundra.s3.html"><span>taoensso.carmine.tundra.s3</span></a></li><li><a href="taoensso.carmine.utils.html"><span>taoensso.carmine.utils</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="taoensso.carmine.tundra.html#var--%3ENippyFreezer"><span>-&gt;NippyFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3ETundraStore"><span>-&gt;TundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-IDataStore"><span>IDataStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-IFreezer"><span>IFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ITundraStore"><span>ITundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-dirty"><span>dirty</span></a></li><li><a href="taoensso.carmine.tundra.html#var-dirty*"><span>dirty*</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ensure-ks"><span>ensure-ks</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ensure-ks*"><span>ensure-ks*</span></a></li><li><a href="taoensso.carmine.tundra.html#var-fetch-key"><span>fetch-key</span></a></li><li><a href="taoensso.carmine.tundra.html#var-freeze"><span>freeze</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3ENippyFreezer"><span>map-&gt;NippyFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3ETundraStore"><span>map-&gt;TundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-nippy-freezer"><span>nippy-freezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-put-key"><span>put-key</span></a></li><li><a href="taoensso.carmine.tundra.html#var-thaw"><span>thaw</span></a></li><li><a href="taoensso.carmine.tundra.html#var-tundra-store"><span>tundra-store</span></a></li><li><a href="taoensso.carmine.tundra.html#var-worker"><span>worker</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>taoensso.carmine.tundra documentation</h2><pre class="doc">Semi-automatic datastore layer for Carmine. It's like the magix.
Use multiple Redis instances (recommended) or Redis databases for local key
namespacing.</pre><div class="public" id="var--%3ENippyFreezer"><h3>-&gt;NippyFreezer</h3><div class="usage"><code>(-&gt;NippyFreezer opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.NippyFreezer.
</pre></div><div class="public" id="var--%3ETundraStore"><h3>-&gt;TundraStore</h3><div class="usage"><code>(-&gt;TundraStore datastore freezer opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.TundraStore.
</pre></div><div class="public" id="var-IDataStore"><h3>IDataStore</h3><div class="usage"></div><pre class="doc">Extension point for additional datastores.
</pre></div><div class="public" id="var-IFreezer"><h3>IFreezer</h3><div class="usage"></div><pre class="doc">Extension point for compressors, encryptors, etc.
</pre></div><div class="public" id="var-ITundraStore"><h3>ITundraStore</h3><div class="usage"></div><pre class="doc"></pre></div><div class="public" id="var-dirty"><h3>dirty</h3><div class="usage"><code>(dirty tstore &amp; ks)</code></div><pre class="doc">Queues given keys for freezing to datastore. Throws an exception if any keys
don't exist. Acts as a Redis command: call within a `wcar` context.

If TundraStore has a :redis-ttl-ms option, **MARKS GIVEN KEYS FOR EXPIRY**!!
** Worker MUST be running AND FUNCTIONING CORRECTLY or DATA WILL BE LOST! **</pre></div><div class="public" id="var-dirty*"><h3>dirty*</h3><div class="usage"><code>(dirty* tstore ks)</code></div><pre class="doc"></pre></div><div class="public" id="var-ensure-ks"><h3>ensure-ks</h3><div class="usage"><code>(ensure-ks tstore &amp; ks)</code></div><pre class="doc">BLOCKS to ensure given keys (previously created) are available in Redis,
fetching them from datastore as necessary. Throws an exception if any keys
couldn't be made available. Acts as a Redis command: call within a `wcar`
context.</pre></div><div class="public" id="var-ensure-ks*"><h3>ensure-ks*</h3><div class="usage"><code>(ensure-ks* tstore ks)</code></div><pre class="doc"></pre></div><div class="public" id="var-fetch-key"><h3>fetch-key</h3><div class="usage"><code>(fetch-key dstore k)</code></div><pre class="doc">(fetch-key dstore &quot;key&quot;) =&gt; e/o #{&lt;frozen-val&gt; &lt;ex&gt;}&quot;
</pre></div><div class="public" id="var-freeze"><h3>freeze</h3><div class="usage"><code>(freeze freezer x)</code></div><pre class="doc">Returns datastore-ready key val.
(comp put-key freeze): dump-ba -&gt; datastore val.</pre></div><div class="public" id="var-map-%3ENippyFreezer"><h3>map-&gt;NippyFreezer</h3><div class="usage"><code>(map-&gt;NippyFreezer m__5818__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.NippyFreezer, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3ETundraStore"><h3>map-&gt;TundraStore</h3><div class="usage"><code>(map-&gt;TundraStore m__5818__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.TundraStore, taking a map of keywords to field values.
</pre></div><div class="public" id="var-nippy-freezer"><h3>nippy-freezer</h3><div class="usage"></div><pre class="doc">Default Nippy Freezer.
</pre></div><div class="public" id="var-put-key"><h3>put-key</h3><div class="usage"><code>(put-key dstore k v)</code></div><pre class="doc">(put-key dstore &quot;key&quot; &lt;frozen-val&gt;) =&gt; e/o #{true &lt;ex&gt;}
</pre></div><div class="public" id="var-thaw"><h3>thaw</h3><div class="usage"><code>(thaw freezer x)</code></div><pre class="doc">Returns Redis-ready key val.
(comp thaw fetch-key): datastore val -&gt; dump-ba.</pre></div><div class="public" id="var-tundra-store"><h3>tundra-store</h3><div class="usage"><code>(tundra-store datastore &amp; [{:keys [freezer redis-ttl-ms], :or {freezer nippy-freezer}}])</code></div><pre class="doc">Alpha - subject to change.
Returns a TundraStore with options:
  datastore     - Storage for frozen key data. Default datastores:
                  `taoensso.carmine.tundra.faraday/faraday-datastore`
                  `taoensso.carmine.tundra.s3/s3-datastore`.
  :freezer      - Optional. Preps key data to/from datastore. May provide
                  services like compression and encryption, etc. Defaults to
                  Nippy with default options (Snappy compression and no
                  encryption).
  :redis-ttl-ms - Optional! Time after which frozen, inactive keys will be
                  EVICTED FROM REDIS (**DELETED!**). Minimum 10 hours. ONLY
                  use this if you have CONFIRMED that your worker is
                  successfully freezing the necessary keys to your datastore.
                  Otherwise YOU WILL IRREVOCABLY **LOSE DATA**.

See `ensure-ks`, `dirty`, `worker` for TundraStore API.</pre></div><div class="public" id="var-worker"><h3>worker</h3><div class="usage"><code>(worker tstore conn wopts)</code></div><pre class="doc">Alpha - subject to change.
Returns a threaded [message queue] worker to routinely freeze Redis keys
marked as dirty to datastore and mark successfully frozen keys as clean.
Logs any errors. THESE ERRORS ARE **IMPORTANT**: an email or other
appropriate notification mechanism is HIGHLY RECOMMENDED. If a worker shuts
down and your keys are set to expire YOU WILL IRREVOCABLY **LOSE DATA**.

Options:
  :nattempts        - Number of times worker will attempt to freeze a key to
                      datastore before failing permanently. &gt;=1.
  :retry-backoff-ms - Amount of time (msecs) to backoff before retrying a
                      failed key freeze. &gt;=0. Can be a (fn [attempt]) -&gt; ms.

  :montior, :eoq-backoff-ms, :nthreads, :throttle-ms, :auto-start?
  - Standard `taoensso.carmine.message-queue/worker` opts.</pre></div></div></body></html>