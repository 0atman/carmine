<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.carmine.tundra documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Carmine 2.3.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="taoensso.carmine.html"><span>taoensso.carmine</span></a></li><li><a href="taoensso.carmine.benchmarks.html"><span>taoensso.carmine.benchmarks</span></a></li><li><a href="taoensso.carmine.commands.html"><span>taoensso.carmine.commands</span></a></li><li><a href="taoensso.carmine.connections.html"><span>taoensso.carmine.connections</span></a></li><li><a href="taoensso.carmine.locks.html"><span>taoensso.carmine.locks</span></a></li><li><a href="taoensso.carmine.message-queue.html"><span>taoensso.carmine.message-queue</span></a></li><li><a href="taoensso.carmine.protocol.html"><span>taoensso.carmine.protocol</span></a></li><li><a href="taoensso.carmine.ring.html"><span>taoensso.carmine.ring</span></a></li><li class="current"><a href="taoensso.carmine.tundra.html"><span>taoensso.carmine.tundra</span></a></li><li><a href="taoensso.carmine.tundra.faraday.html"><span>taoensso.carmine.tundra.faraday</span></a></li><li><a href="taoensso.carmine.utils.html"><span>taoensso.carmine.utils</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="taoensso.carmine.tundra.html#var--%3EDiskDataStore"><span>-&gt;DiskDataStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3ENippyFreezer"><span>-&gt;NippyFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3ETundraStore"><span>-&gt;TundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var--%3EWorker"><span>-&gt;Worker</span></a></li><li><a href="taoensso.carmine.tundra.html#var-IDataStore"><span>IDataStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-IFreezer"><span>IFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ITundraStore"><span>ITundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-IWorker"><span>IWorker</span></a></li><li><a href="taoensso.carmine.tundra.html#var-dirty"><span>dirty</span></a></li><li><a href="taoensso.carmine.tundra.html#var-dirty*"><span>dirty*</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ensure-ks"><span>ensure-ks</span></a></li><li><a href="taoensso.carmine.tundra.html#var-ensure-ks*"><span>ensure-ks*</span></a></li><li><a href="taoensso.carmine.tundra.html#var-fetch-keys"><span>fetch-keys</span></a></li><li><a href="taoensso.carmine.tundra.html#var-freeze"><span>freeze</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3EDiskDataStore"><span>map-&gt;DiskDataStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3ENippyFreezer"><span>map-&gt;NippyFreezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3ETundraStore"><span>map-&gt;TundraStore</span></a></li><li><a href="taoensso.carmine.tundra.html#var-map-%3EWorker"><span>map-&gt;Worker</span></a></li><li><a href="taoensso.carmine.tundra.html#var-nippy-freezer"><span>nippy-freezer</span></a></li><li><a href="taoensso.carmine.tundra.html#var-put-keys"><span>put-keys</span></a></li><li><a href="taoensso.carmine.tundra.html#var-start"><span>start</span></a></li><li><a href="taoensso.carmine.tundra.html#var-stop"><span>stop</span></a></li><li><a href="taoensso.carmine.tundra.html#var-thaw"><span>thaw</span></a></li><li><a href="taoensso.carmine.tundra.html#var-tundra-store"><span>tundra-store</span></a></li><li><a href="taoensso.carmine.tundra.html#var-worker"><span>worker</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>taoensso.carmine.tundra documentation</h2><pre class="doc">Alpha - subject to change (hide the kittens!).
Semi-automatic datastore layer for Carmine. It's like the magix.

Redis (2.6+) keys:
  * carmine:tundra:dirty    -&gt; set, dirty Redis keys.
  * carmine:tundra:cleaning -&gt; set, Redis keys currently being frozen
                               to datastore. Used for crash protection.

Use multiple Redis instances (recommended) or Redis databases for local key
namespacing.</pre><div class="public" id="var--%3EDiskDataStore"><h3>-&gt;DiskDataStore</h3><div class="usage"><code>(-&gt;DiskDataStore path)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.DiskDataStore.
</pre></div><div class="public" id="var--%3ENippyFreezer"><h3>-&gt;NippyFreezer</h3><div class="usage"><code>(-&gt;NippyFreezer opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.NippyFreezer.
</pre></div><div class="public" id="var--%3ETundraStore"><h3>-&gt;TundraStore</h3><div class="usage"><code>(-&gt;TundraStore datastore freezer opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.TundraStore.
</pre></div><div class="public" id="var--%3EWorker"><h3>-&gt;Worker</h3><div class="usage"><code>(-&gt;Worker conn work-fn running? opts)</code></div><pre class="doc">Positional factory function for class taoensso.carmine.tundra.Worker.
</pre></div><div class="public" id="var-IDataStore"><h3>IDataStore</h3><div class="usage"></div><pre class="doc"></pre></div><div class="public" id="var-IFreezer"><h3>IFreezer</h3><div class="usage"></div><pre class="doc"></pre></div><div class="public" id="var-ITundraStore"><h3>ITundraStore</h3><div class="usage"></div><pre class="doc"></pre></div><div class="public" id="var-IWorker"><h3>IWorker</h3><div class="usage"></div><pre class="doc"></pre></div><div class="public" id="var-dirty"><h3>dirty</h3><div class="usage"><code>(dirty store &amp; ks)</code></div><pre class="doc">Alpha - subject to change.
**MARKS GIVEN KEYS FOR EXPIRY** and adds them to dirty set for freezing to
datastore on worker's next scheduled freeze. Throws an exception if any keys
don't exist. Acts as a Redis command: call within a `wcar` context.

****************************************************************************
** Worker MUST be running AND FUNCTIONING CORRECTLY or DATA WILL BE LOST! **
****************************************************************************</pre></div><div class="public" id="var-dirty*"><h3>dirty*</h3><div class="usage"><code>(dirty* store ks)</code></div><pre class="doc"></pre></div><div class="public" id="var-ensure-ks"><h3>ensure-ks</h3><div class="usage"><code>(ensure-ks store &amp; ks)</code></div><pre class="doc">Alpha - subject to change.
BLOCKS to ensure given keys (previously created) are available in Redis,
fetching them from datastore as necessary. Throws an exception if any keys
couldn't be made available. Acts as a Redis command: call within a `wcar`
context.</pre></div><div class="public" id="var-ensure-ks*"><h3>ensure-ks*</h3><div class="usage"><code>(ensure-ks* store ks)</code></div><pre class="doc"></pre></div><div class="public" id="var-fetch-keys"><h3>fetch-keys</h3><div class="usage"><code>(fetch-keys store ks)</code></div><pre class="doc">[&lt;k&gt; ...] -&gt; {&lt;k&gt; &lt;frozen-data&gt;}.
</pre></div><div class="public" id="var-freeze"><h3>freeze</h3><div class="usage"><code>(freeze freezer x)</code></div><pre class="doc">Returns datastore-ready key data.
</pre></div><div class="public" id="var-map-%3EDiskDataStore"><h3>map-&gt;DiskDataStore</h3><div class="usage"><code>(map-&gt;DiskDataStore m__5818__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.DiskDataStore, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3ENippyFreezer"><h3>map-&gt;NippyFreezer</h3><div class="usage"><code>(map-&gt;NippyFreezer m__5818__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.NippyFreezer, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3ETundraStore"><h3>map-&gt;TundraStore</h3><div class="usage"><code>(map-&gt;TundraStore m__5818__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.TundraStore, taking a map of keywords to field values.
</pre></div><div class="public" id="var-map-%3EWorker"><h3>map-&gt;Worker</h3><div class="usage"><code>(map-&gt;Worker m__5818__auto__)</code></div><pre class="doc">Factory function for class taoensso.carmine.tundra.Worker, taking a map of keywords to field values.
</pre></div><div class="public" id="var-nippy-freezer"><h3>nippy-freezer</h3><div class="usage"></div><pre class="doc">Default Nippy Freezer.
</pre></div><div class="public" id="var-put-keys"><h3>put-keys</h3><div class="usage"><code>(put-keys store keyed-data)</code></div><pre class="doc">{&lt;k&gt; &lt;frozen-data&gt; ...} -&gt; {&lt;k&gt; &lt;success?&gt; ...}.
</pre></div><div class="public" id="var-start"><h3>start</h3><div class="usage"><code>(start this)</code></div><pre class="doc">Returns true iff worker successfully started.
</pre></div><div class="public" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop this)</code></div><pre class="doc">Returns true iff worker successfully stopped.
</pre></div><div class="public" id="var-thaw"><h3>thaw</h3><div class="usage"><code>(thaw freezer x)</code></div><pre class="doc">Returns Redis-ready key data.
</pre></div><div class="public" id="var-tundra-store"><h3>tundra-store</h3><div class="usage"><code>(tundra-store datastore &amp; [{:keys [redis-ttl-ms freezer], :or {redis-ttl-ms (* 1000 60 60 24 31), freezer nippy-freezer}}])</code></div><pre class="doc">Alpha - subject to change.
Returns a TundraStore with options:
  datastore     - Storage for frozen key data.
                  See `taoensso.carmine.tundra.faraday/faraday-datastore` for
                  Faraday (DynamoDB) datastore.
  :redis-ttl-ms - Optional. Time after which frozen, inactive keys will be
                  EVICTED FROM REDIS. Defaults to ~31 days, minimum 10 hours.
  :freezer      - Optional. Preps key data to/from datastore. May provide
                  services like compression and encryption, etc. Defaults to
                  Nippy with default options (Snappy compression and no
                  encryption).

See `ensure-ks`, `dirty`, `worker` for TundraStore API.</pre></div><div class="public" id="var-worker"><h3>worker</h3><div class="usage"><code>(worker store conn opts)</code></div><pre class="doc">Alpha - subject to change.
Returns a threaded worker to routinely freeze Redis keys marked as dirty
to datastore and mark successfully frozen keys as clean. Logs any errors.
THESE ERRORS ARE IMPORTANT: an email or other appropriate notification
mechanism is HIGHLY RECOMMENDED.

Options: :frequency-ms - Interval between each freezing.</pre></div></div></body></html>