<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.carmine.tundra documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Carmine 2.12.0-beta1 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>taoensso</span></div></div></li><li class="depth-2"><a href="taoensso.carmine.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>carmine</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.benchmarks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>benchmarks</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.cluster.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cluster</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.commands.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>commands</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.connections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>connections</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.locks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>locks</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.message-queue.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message-queue</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.ring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></a></li><li class="depth-3 current"><a href="taoensso.carmine.tundra.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tundra</span></div></a></li><li class="depth-4 branch"><a href="taoensso.carmine.tundra.carmine.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>carmine</span></div></a></li><li class="depth-4 branch"><a href="taoensso.carmine.tundra.disk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>disk</span></div></a></li><li class="depth-4 branch"><a href="taoensso.carmine.tundra.faraday.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faraday</span></div></a></li><li class="depth-4"><a href="taoensso.carmine.tundra.s3.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>s3</span></div></a></li><li class="depth-3"><a href="taoensso.carmine.utils.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.carmine.tundra.html#var--.3ENippyFreezer"><div class="inner"><span>-&gt;NippyFreezer</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var--.3ETundraStore"><div class="inner"><span>-&gt;TundraStore</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-.3Curlsafe-str"><div class="inner"><span>&lt;urlsafe-str</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-.3Eurlsafe-str"><div class="inner"><span>&gt;urlsafe-str</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-catcht"><div class="inner"><span>catcht</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-dirty"><div class="inner"><span>dirty</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-ensure-ks"><div class="inner"><span>ensure-ks</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-extend-exists-missing-ks"><div class="inner"><span>extend-exists-missing-ks</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-fetch-keys-delayed"><div class="inner"><span>fetch-keys-delayed</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-IDataStore"><div class="inner"><span>IDataStore</span></div></a></li><li class="depth-2 branch"><a href="taoensso.carmine.tundra.html#var-fetch-keys"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fetch-keys</span></div></a></li><li class="depth-2"><a href="taoensso.carmine.tundra.html#var-put-key"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>put-key</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-IFreezer"><div class="inner"><span>IFreezer</span></div></a></li><li class="depth-2 branch"><a href="taoensso.carmine.tundra.html#var-freeze"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>freeze</span></div></a></li><li class="depth-2"><a href="taoensso.carmine.tundra.html#var-thaw"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>thaw</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-ITundraStore"><div class="inner"><span>ITundraStore</span></div></a></li><li class="depth-2 branch"><a href="taoensso.carmine.tundra.html#var-dirty*"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dirty*</span></div></a></li><li class="depth-2 branch"><a href="taoensso.carmine.tundra.html#var-ensure-ks*"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ensure-ks*</span></div></a></li><li class="depth-2"><a href="taoensso.carmine.tundra.html#var-worker"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>worker</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-map-.3ENippyFreezer"><div class="inner"><span>map-&gt;NippyFreezer</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-map-.3ETundraStore"><div class="inner"><span>map-&gt;TundraStore</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-nippy-freezer"><div class="inner"><span>nippy-freezer</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.tundra.html#var-tundra-store"><div class="inner"><span>tundra-store</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">taoensso.carmine.tundra</h2><div class="doc"><pre class="plaintext">Semi-automatic datastore layer for Carmine. It&apos;s like the magix.
Use multiple Redis instances (recommended) or Redis databases for local key
namespacing.

Redis keys:
  * carmine:tundra:evictable -&gt; set, keys for which `ensure-ks` fetch failure
                                should throw an error.</pre></div><div class="public anchor" id="var--.3ENippyFreezer"><h3>-&gt;NippyFreezer</h3><div class="usage"><code>(-&gt;NippyFreezer opts)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class taoensso.carmine.tundra.NippyFreezer.
</pre></div></div><div class="public anchor" id="var--.3ETundraStore"><h3>-&gt;TundraStore</h3><div class="usage"><code>(-&gt;TundraStore datastore freezer opts)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class taoensso.carmine.tundra.TundraStore.
</pre></div></div><div class="public anchor" id="var-.3Curlsafe-str"><h3>&lt;urlsafe-str</h3><div class="usage"><code>(&lt;urlsafe-str s)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-.3Eurlsafe-str"><h3>&gt;urlsafe-str</h3><div class="usage"><code>(&gt;urlsafe-str s)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-catcht"><h3>catcht</h3><h4 class="type">macro</h4><div class="usage"><code>(catcht &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-dirty"><h3>dirty</h3><div class="usage"><code>(dirty tstore &amp; ks)</code></div><div class="doc"><pre class="plaintext">Queues given keys for freezing to datastore. Throws an exception if any keys
don&apos;t exist. Acts as a Redis command: call within a `wcar` context.

If TundraStore has a :redis-ttl-ms option, **MARKS GIVEN KEYS FOR EXPIRY**!!
** Worker MUST be running AND FUNCTIONING CORRECTLY or DATA WILL BE LOST! **</pre></div></div><div class="public anchor" id="var-ensure-ks"><h3>ensure-ks</h3><div class="usage"><code>(ensure-ks tstore &amp; ks)</code></div><div class="doc"><pre class="plaintext">BLOCKS to ensure given keys are available in Redis, fetching them from
datastore as necessary. Throws an exception if any previously evicted keys
couldn&apos;t be made available. Acts as a Redis command: call within a `wcar`
context.</pre></div></div><div class="public anchor" id="var-extend-exists-missing-ks"><h3>extend-exists-missing-ks</h3><div class="usage"><code>(extend-exists-missing-ks ttl-ms ks &amp; [only-evictable?])</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-fetch-keys-delayed"><h3>fetch-keys-delayed</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Used to prevent multiple threads from rushing the datastore to get the same
keys, unnecessarily duplicating work.</pre></div></div><div class="public anchor" id="var-IDataStore"><h3>IDataStore</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Extension point for additional datastores.
</pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-fetch-keys"><h3>fetch-keys</h3><div class="usage"><code>(fetch-keys dstore ks)</code></div><div class="doc"><pre class="plaintext">(fetch-keys dstore [&quot;key&quot; ...]) =&gt; [&lt;#{&lt;frozen-val&gt; &lt;ex&gt;}&gt; ...]
</pre></div></div><div class="public anchor" id="var-put-key"><h3>put-key</h3><div class="usage"><code>(put-key dstore k v)</code></div><div class="doc"><pre class="plaintext">(put-key dstore &quot;key&quot; &lt;frozen-val&gt;) =&gt; &lt;#{true &lt;ex&gt;}&gt;
</pre></div></div></div></div></div><div class="public anchor" id="var-IFreezer"><h3>IFreezer</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext">Extension point for compressors, encryptors, etc.
</pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-freeze"><h3>freeze</h3><div class="usage"><code>(freeze freezer x)</code></div><div class="doc"><pre class="plaintext">Returns datastore-ready key val.
(comp put-key freeze): dump-ba -&gt; datastore val.</pre></div></div><div class="public anchor" id="var-thaw"><h3>thaw</h3><div class="usage"><code>(thaw freezer x)</code></div><div class="doc"><pre class="plaintext">Returns Redis-ready key val.
(comp thaw fetch-key): datastore val -&gt; dump-ba.</pre></div></div></div></div></div><div class="public anchor" id="var-ITundraStore"><h3>ITundraStore</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-dirty*"><h3>dirty*</h3><div class="usage"><code>(dirty* tstore ks)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-ensure-ks*"><h3>ensure-ks*</h3><div class="usage"><code>(ensure-ks* tstore ks)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-worker"><h3>worker</h3><div class="usage"><code>(worker tstore conn-opts wopts)</code></div><div class="doc"><pre class="plaintext">Alpha - subject to change.
Returns a threaded message queue worker to routinely freeze Redis keys
marked as dirty to datastore and mark successfully frozen keys as clean.
Logs any errors. THESE ERRORS ARE **IMPORTANT**: an email or other
appropriate notification mechanism is HIGHLY RECOMMENDED. If a worker shuts
down and your keys are set to expire YOU WILL IRREVOCABLY **LOSE DATA**.

Options:
  :nattempts        - Number of times worker will attempt to freeze a key to
                      datastore before failing permanently. &gt;=1.
  :retry-backoff-ms - Amount of time (msecs) to backoff before retrying a
                      failed key freeze. &gt;=0. Can be a (fn [attempt]) -&gt; ms.

  :montior, :eoq-backoff-ms, :nthreads, :throttle-ms, :auto-start
  - Standard `taoensso.carmine.message-queue/worker` opts.</pre></div></div></div></div></div><div class="public anchor" id="var-map-.3ENippyFreezer"><h3>map-&gt;NippyFreezer</h3><div class="usage"><code>(map-&gt;NippyFreezer m__6289__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class taoensso.carmine.tundra.NippyFreezer, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-map-.3ETundraStore"><h3>map-&gt;TundraStore</h3><div class="usage"><code>(map-&gt;TundraStore m__6289__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class taoensso.carmine.tundra.TundraStore, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-nippy-freezer"><h3>nippy-freezer</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Default Nippy Freezer.
</pre></div></div><div class="public anchor" id="var-tundra-store"><h3>tundra-store</h3><div class="usage"><code>(tundra-store datastore &amp; [{:keys [tqname freezer redis-ttl-ms], :or {tqname :default, freezer nippy-freezer}}])</code></div><div class="doc"><pre class="plaintext">Alpha - subject to change.
Returns a TundraStore with options:
  datastore     - Storage for frozen key data. Default datastores:
                  `taoensso.carmine.tundra.faraday/faraday-datastore`
                  `taoensso.carmine.tundra.s3/s3-datastore`.
  :tqname       - Optional. Worker message queue name.
  :freezer      - Optional. Preps key data to/from datastore. May provide
                  services like compression and encryption, etc. Defaults to
                  Nippy with default options (Snappy compression and no
                  encryption).
  :redis-ttl-ms - Optional! Time after which frozen, inactive keys will be
                  EVICTED FROM REDIS (**DELETED!**). Minimum 10 hours. ONLY
                  use this if you have CONFIRMED that your worker is
                  successfully freezing the necessary keys to your datastore.
                  Otherwise YOU WILL IRREVOCABLY **LOSE DATA**.

See `ensure-ks`, `dirty`, `worker` for TundraStore API.</pre></div></div></div></body></html>