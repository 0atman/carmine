<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>taoensso.carmine.protocol documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Carmine 2.12.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>taoensso</span></div></div></li><li class="depth-2"><a href="taoensso.carmine.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>carmine</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.benchmarks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>benchmarks</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.cluster.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cluster</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.commands.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>commands</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.connections.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>connections</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.locks.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>locks</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.message-queue.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message-queue</span></div></a></li><li class="depth-3 branch current"><a href="taoensso.carmine.protocol.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>protocol</span></div></a></li><li class="depth-3 branch"><a href="taoensso.carmine.ring.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ring</span></div></a></li><li class="depth-3"><a href="taoensso.carmine.tundra.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tundra</span></div></a></li><li class="depth-4 branch"><a href="taoensso.carmine.tundra.carmine.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>carmine</span></div></a></li><li class="depth-4 branch"><a href="taoensso.carmine.tundra.disk.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>disk</span></div></a></li><li class="depth-4 branch"><a href="taoensso.carmine.tundra.faraday.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>faraday</span></div></a></li><li class="depth-4"><a href="taoensso.carmine.tundra.s3.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>s3</span></div></a></li><li class="depth-3"><a href="taoensso.carmine.utils.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-*context*"><div class="inner"><span>*context*</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-*nested-stash-consumed.3F_*"><div class="inner"><span>*nested-stash-consumed?_*</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-*nested-stashed-reqs*"><div class="inner"><span>*nested-stashed-reqs*</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-*parser*"><div class="inner"><span>*parser*</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var--.3EContext"><div class="inner"><span>-&gt;Context</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var--.3EWrappedRaw"><div class="inner"><span>-&gt;WrappedRaw</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-bs-.24"><div class="inner"><span>bs-$</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-bs-*"><div class="inner"><span>bs-*</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-bs-bin"><div class="inner"><span>bs-bin</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-bs-clj"><div class="inner"><span>bs-clj</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-bs-crlf"><div class="inner"><span>bs-crlf</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-execute-requests"><div class="inner"><span>execute-requests</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-get-parsed-reply"><div class="inner"><span>get-parsed-reply</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-get-unparsed-reply"><div class="inner"><span>get-unparsed-reply</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-IRedisArg"><div class="inner"><span>IRedisArg</span></div></a></li><li class="depth-2"><a href="taoensso.carmine.protocol.html#var-coerce-bs"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coerce-bs</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-map-.3EContext"><div class="inner"><span>map-&gt;Context</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-map-.3EWrappedRaw"><div class="inner"><span>map-&gt;WrappedRaw</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-no-context-ex"><div class="inner"><span>no-context-ex</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-parse"><div class="inner"><span>parse</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-parse-nippy"><div class="inner"><span>parse-nippy</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-parse-raw"><div class="inner"><span>parse-raw</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-parser-comp"><div class="inner"><span>parser-comp</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-pull-requests"><div class="inner"><span>pull-requests</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-raw"><div class="inner"><span>raw</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-return"><div class="inner"><span>return</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-return-parsed-replies"><div class="inner"><span>return-parsed-replies</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-suppressed-reply-kw"><div class="inner"><span>suppressed-reply-kw</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-with-context"><div class="inner"><span>with-context</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-with-replies"><div class="inner"><span>with-replies</span></div></a></li><li class="depth-1"><a href="taoensso.carmine.protocol.html#var-with-replies*"><div class="inner"><span>with-replies*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">taoensso.carmine.protocol</h2><div class="doc"><pre class="plaintext">Facilities for actually communicating with Redis server using its
request/response protocol. Originally adapted from Accession.
Ref. <a href="http://redis.io/topics/protocol">http://redis.io/topics/protocol</a></pre></div><div class="public anchor" id="var-*context*"><h3>*context*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-*nested-stash-consumed.3F_*"><h3>*nested-stash-consumed?_*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-*nested-stashed-reqs*"><h3>*nested-stashed-reqs*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-*parser*"><h3>*parser*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var--.3EContext"><h3>-&gt;Context</h3><div class="usage"><code>(-&gt;Context conn req-queue)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class taoensso.carmine.protocol.Context.
</pre></div></div><div class="public anchor" id="var--.3EWrappedRaw"><h3>-&gt;WrappedRaw</h3><div class="usage"><code>(-&gt;WrappedRaw ba)</code></div><div class="doc"><pre class="plaintext">Positional factory function for class taoensso.carmine.protocol.WrappedRaw.
</pre></div></div><div class="public anchor" id="var-bs-.24"><h3>bs-$</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-bs-*"><h3>bs-*</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-bs-bin"><h3>bs-bin</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-bs-clj"><h3>bs-clj</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-bs-crlf"><h3>bs-crlf</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-execute-requests"><h3>execute-requests</h3><div class="usage"><code>(execute-requests get-replies? as-pipeline?)</code><code>(execute-requests conn requests get-replies? as-pipeline?)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
Sends given/dynamic requests to given/dynamic Redis server and optionally
blocks to receive the relevant queued (pipelined) parsed replies.</pre></div></div><div class="public anchor" id="var-get-parsed-reply"><h3>get-parsed-reply</h3><div class="usage"><code>(get-parsed-reply in ?parser)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
</pre></div></div><div class="public anchor" id="var-get-unparsed-reply"><h3>get-unparsed-reply</h3><div class="usage"><code>(get-unparsed-reply in req-opts)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
BLOCKS to receive a single reply from Redis server and returns the result as
[&lt;type&gt; &lt;reply&gt;]. Redis will reply to commands with different kinds of replies,
identified by their first byte, Ref. <a href="http://redis.io/topics/protocol">http://redis.io/topics/protocol</a>:

  * `+` for simple strings -&gt; &lt;string&gt;
  * `:` for integers       -&gt; &lt;long&gt;
  * `-` for error strings  -&gt; &lt;ex-info&gt;
  * `$` for bulk strings   -&gt; &lt;clj&gt;/&lt;raw-bytes&gt;    ; Marked as serialized
                           -&gt; &lt;bytes&gt;/&lt;raw-bytes&gt;  ; Marked as binary
                           -&gt; &lt;string&gt;/&lt;raw-bytes&gt; ; Unmarked
                           -&gt; nil
  * `*` for arrays         -&gt; &lt;vector&gt;
                           -&gt; nil</pre></div></div><div class="public anchor" id="var-IRedisArg"><h3>IRedisArg</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-coerce-bs"><h3>coerce-bs</h3><div class="usage"><code>(coerce-bs x)</code></div><div class="doc"><pre class="plaintext">Coerces arbitrary Clojure value to RESP arg, by type.
</pre></div></div></div></div></div><div class="public anchor" id="var-map-.3EContext"><h3>map-&gt;Context</h3><div class="usage"><code>(map-&gt;Context m__6289__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class taoensso.carmine.protocol.Context, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-map-.3EWrappedRaw"><h3>map-&gt;WrappedRaw</h3><div class="usage"><code>(map-&gt;WrappedRaw m__6289__auto__)</code></div><div class="doc"><pre class="plaintext">Factory function for class taoensso.carmine.protocol.WrappedRaw, taking a map of keywords to field values.
</pre></div></div><div class="public anchor" id="var-no-context-ex"><h3>no-context-ex</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-parse"><h3>parse</h3><h4 class="type">macro</h4><div class="usage"><code>(parse f &amp; body)</code></div><div class="doc"><pre class="plaintext">Wraps body so that replies to any wrapped Redis commands will be parsed with
`(f reply)`. Replaces any current parser; removes parser when `f` is nil.
See also `parser-comp`.</pre></div></div><div class="public anchor" id="var-parse-nippy"><h3>parse-nippy</h3><h4 class="type">macro</h4><div class="usage"><code>(parse-nippy thaw-opts &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-parse-raw"><h3>parse-raw</h3><h4 class="type">macro</h4><div class="usage"><code>(parse-raw &amp; body)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-parser-comp"><h3>parser-comp</h3><div class="usage"><code>(parser-comp f g)</code></div><div class="doc"><pre class="plaintext">Composes parsers when f or g are nnil, preserving metadata.
</pre></div></div><div class="public anchor" id="var-pull-requests"><h3>pull-requests</h3><div class="usage"><code>(pull-requests req-queue)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
</pre></div></div><div class="public anchor" id="var-raw"><h3>raw</h3><div class="usage"><code>(raw x)</code></div><div class="doc"><pre class="plaintext">Forces byte[] argument to be sent to Redis as raw, unencoded bytes.
</pre></div></div><div class="public anchor" id="var-return"><h3>return</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Takes values and returns them as part of next reply from Redis server.
Unlike `echo`, does not actually send any data to Redis.</pre></div></div><div class="public anchor" id="var-return-parsed-replies"><h3>return-parsed-replies</h3><div class="usage"><code>(return-parsed-replies preplies as-pipeline?)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
</pre></div></div><div class="public anchor" id="var-suppressed-reply-kw"><h3>suppressed-reply-kw</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-with-context"><h3>with-context</h3><h4 class="type">macro</h4><div class="usage"><code>(with-context conn &amp; body)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
</pre></div></div><div class="public anchor" id="var-with-replies"><h3>with-replies</h3><h4 class="type">macro</h4><div class="usage"><code>(with-replies :as-pipeline &amp; body)</code><code>(with-replies &amp; body)</code></div><div class="doc"><pre class="plaintext">Alpha - subject to change.
Evaluates body, immediately returning the server&apos;s response to any contained
Redis commands (i.e. before enclosing context ends).

As an implementation detail, stashes and then `return`s any replies already
queued with Redis server: i.e. should be compatible with pipelining.

Note on parsers: if you&apos;re writing a Redis command (e.g. a fn that is intended
to execute w/in an implicit connection context) and you&apos;re using `with-replies`
as an implementation detail (i.e. you&apos;re interpreting replies internally), you
probably want `(parse nil (with-replies ...))` to keep external parsers from
leaking into your internal logic.</pre></div></div><div class="public anchor" id="var-with-replies*"><h3>with-replies*</h3><div class="usage"><code>(with-replies* body-fn as-pipeline?)</code></div><div class="doc"><pre class="plaintext">Implementation detail.
</pre></div></div></div></body></html>